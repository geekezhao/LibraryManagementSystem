##项目简介

- **项目名称:** 图书管理系统

- **项目目的:** 这个项目要实现的功能包括：
 * 创建账户/修改账户信息/销户
 * 书籍上架(理论上是管理员入口对应的功能)
 * 查询书籍及其副本情况
 * 荐购书本
 * 借阅书本
 * 借阅等待序列
 * 罚款系统


- **系统环境：** 

	- **操作系统:** MacOS Sierra  
	- **SQL版本:** mysql Ver 14.14 Distrib 5.7.17  
	- **Java版本:** java version "1.8.0_131"   
	- **SQL连接Java:** mysql-connect-java-5.1.42  
	- **接口编程语言:** Java  

##系统架构
###1. 图书管理系统结构
![图书管理系统.jpg-30.8kB][1]

###2. E-R图
![!\[\](realER.jpg)][2]


##数据库设计

###SQL

- **书目表** ***(book)***

|属性名|别名|变量类型及长度|说明|
|-----|---|----|----|
|国际书码|ISBN	|numeric(10,0)|主键|
|书名|book_name|	varchar(50)||
|出版社|  publish_house	|varchar(50)|
|作者|  writer	|varchar(50)|
|中图分类|  category	|enum ('A','B','C','D','E','F','G','H','I','J','K','N',
|||'O','P','Q','R','S','T','U','V','X','Z')|


- **副本表** ***(book\_info)***

|属性名|别名|变量类型及长度|说明|
|-----|---|----|----|
|国际书码|ISBN|numeric(10,0)|主键，外键|
|总副本数   | total	|numeric(2,0)||
|副本编号 |   duplicate_num	|numeric(2,0)|主键|
|副本状态	|state|	enum ('on','out')||


- **读者表** ***(reader)***

|属性名|别名|变量类型及长度|说明|
|-----|---|----|----|
|读者证编号	|usr_num	|smallint(6)|主键, auto\_increment|
|姓名|    usr_name|	varchar(50) |与phone组合unique|
|地址|    address	|varchar(50)|
|邮箱|    email	|varchar(256)|
|电话  |  phone|	varchar(13)|与usr\_name组合unique
|总借阅量|total|numeric(2,0)|default 0
|登录密码|password|varchar(50)|not null


- **荐购表** ***(book\_in\_need)***

|属性名|别名|变量类型及长度|说明|
|-----|---|----|----|
|书名|book_name	|varchar(50)|主键
|出版社|    publish_house|	varchar(50)
|作者|   writer|	varchar(50)|主键
|荐购状态|    state	|enum('finding','determined','notyet')|default 'notyet'


- **借阅表** ***(borrow)***

|属性名|别名|变量类型及长度|说明|
|-----|---|----|----|
|读者证编号|usr_num	|smallint(6)|主键，外键
|国际书码|    ISBN	|numeric(10,0)|主键，外键
|借阅日期|    borrow_day	|timestamp
|借阅次数|borrow_times|numeric(1,0)|default 1



- **等待列表** ***(waiting)***

|属性名|别名|变量类型及长度|说明|
|-----|---|----|----|
|读者证编号|usr_num	|smallint(6)|主键，外键
|国际书码|    ISBN	|numeric(10,0)|主键，外键
|请求日期|    request_day	|timestamp
|状态|    state	|enum('Satisfied','notyet')|default 'notyet'


- **TRIGGER** ***borrow_delete_change_reader_total***
    用于在借阅记录删除后从用户总借阅量-1
- **TRIGGER** ***total_change_after_insert_in_borrow***
    用于在插入借阅记录后在用户总借阅量+1


###JAVA
- java.sql.*;
- java.util.*;
- java.text.ParseException;
    解决格式间转化异常
- java.io.*;
    输入输出流
- java.lang.NumberFormatException;
    解决数组输入格式异常



## 使用方法及说明
###关于账户
- **开户/销户/更新账户信息**
	
		用于开户，销户和更新账户信息。
        有罚款或者未还书目的时候不能删除账户

- **逾期罚款查询**

		1. 用于查询罚款，如有逾期，按日计算罚款，每本每日0.1元，查询输出所有借阅记录累计罚款额;
		2. 当前账户有罚款的时候借阅权限收回，但是不影响已经借阅的书籍。
		
- **应还日期查询**

		1. 如有正在借阅书本，将会显示对应书目、借阅日期和应还日期；
		2. 可在应还日期界面续借尚未逾期且不存在借阅等待序列的书籍。
		
- **预约请求查询**

        1. 读者借阅缺少架上副本的书籍将会进入借阅等待序列；
		2. 借阅书籍如果有人归还，依照进入该书借阅列表的顺序依次满足；
        3. 借阅请求一旦被满足，在查询借阅等待序列记录时将会自动提示是否借阅，该界面内即可实现借阅；
        4. 一旦预约请求提示被满足，选择不借阅即删除预约请求，借阅优先级按照借阅等待序列顺延或释放被预约副本。

###关于书目
- **书目查询**

		1. 当前提供书名字段的部分值检索，支持中文书名检索，不支持拼音检索，不区分英文大小写；
		2. 返回量控制20条，每一条都会提示是否借阅。
	
- **借阅/归还**

		1. 借阅受到副本量控制，当存在架上副本的时候才能借阅，否则进入借阅等待序列；
		2. 借阅上限12本；
		3. 超过借书上限以及有罚款的时候不能借书。

- **书目荐购**

		1. 用于荐购，支持同一本书不同出版社的版本荐购；
		2. 暂时没有加入审核功能，因此无法和书目表属性对接。
		
- **借阅等待序列**

		读者借阅缺少架上副本的书籍将会进入借阅等待序列；
		
###一些问题和解决方法
1. **账号编号：**   

    本项目选择的方法是***auto_increment***，好处一是省的自己输，二是避免重复主键（如果在java里设一个自增量就会每次执行从头开始），坏处是如果删掉账号不能自动补缺而是继续编号。同时，为了返回唯一记录以获得账户号，设置`usr_name`和`phone`两个字段***unique***，这样可以包含一个家庭用同一个手机号但是每个人都有卡的情况以及一个人有好几个手机的情况（除非用身份证作为主键，否则应该无法避免个人重复开户），然后阻止其余的重复开户情况，当然，直接返回最后一条记录功能上也是一样的。  
	
    总而言之，用户需要记住自己的账号，不然就没办法找回账号。
	
2. **借阅量和等待序列：**  

	本项目设置的是自动选取编号最小的空余副本借阅，并且归还的时候也是自动释放编号最小的一条（保证被借阅副本数目正确），但是暂时还没实现等待序列自动满足以及预约过号删除，这使得将出现有人还了以后你可以立即借阅，反倒是借阅列表的人没办法满足。
	
3. **罚款和借阅日期计算**	 
            
    本项目原本设置了罚款表，但是在sql尽管能实现日期加减（通过***trigger***调用***timeup()***自动增加`return_day`属性），也可以实现罚款计算，最终还是选择了通过调取***borrow***表的`borrow_day`属性在java中实现应还日期以及罚款的计算。


4. **账号密码登录**

    账号密码登录给测试带来了麻烦，但是使得操作安全性上升。本项目中使用***CheckAccount***函数匹配账号和密码。

5. **异常输入**

    本项目设置了try...catch...，主要针对IO、格式转换以及SQL异常，或有疏漏请见谅。
        
<br /> 

###尚未实现的功能

1. 管理员入口

    预期的实现方法为：
    - 增加包含密码`password`属性的管理员表***(manager)***；
    - 每次选择管理员入口获取密码比对`password`即可。
    
    另外地，原本在管理员入口下增加了审核荐购表和插入书目表的功能，未实现，当然也没在设计图上体现。

2. 罚款上限
    
    因为没有设置书价这个属性，所以没办法以书价作为罚款上限。如果设计这个功能，那么还要涉及“90年以前的书按照书价10倍收取，90年以后的书按照书价收取”这样的条例。但对于这份大作业而言，只需要进行一个返回值比较，这是本项目已经实现过的功能，所以在功能体现上并没有什么意义。

3. 登录密码加密

    普通用户使用账户和密码的方式登录，更加复杂地可以[对密码进行加密](http://blog.csdn.net/Tracyhuixingfu/article/details/46653659)，但是增加一个加密模块太复杂了所以使用了“记住账户名”这种平庸的方法。
    
4. 缴纳罚款
    
    由于缴纳罚款这个功能在这个数据库里没有意义（并不能真正从银行卡扣钱，最多也只是象征性地输入一个数字然后删除数据库里的一条记录），所以本项目没有实现。



##Announcement
>I have done all these work by myself.
